<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Shared Library Example | Mainframe DevOps</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/CPWR_DevOps_Examples/assets/css/0.styles.38688a71.css" as="style"><link rel="preload" href="/CPWR_DevOps_Examples/assets/js/app.75a8ec7a.js" as="script"><link rel="preload" href="/CPWR_DevOps_Examples/assets/js/7.3a9c137b.js" as="script"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/10.4dc795ba.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/11.5935f050.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/12.0e2b9aca.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/13.78ae9647.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/14.a029e60a.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/15.ffe0034a.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/16.b348e724.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/17.ebd3ec0b.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/18.a8b355c3.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/19.46164589.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/2.da451cf3.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/20.da3c9874.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/21.461a1ac0.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/22.7e875135.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/23.f7fea76c.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/24.ae7c84bf.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/25.475d2aec.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/26.5e15d442.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/27.270e41aa.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/28.206d73f5.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/29.e41f7579.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/3.2a4c636b.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/30.61d12a91.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/31.e2654db9.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/32.be1c41d7.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/33.0efeaca3.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/34.1b4a3f7e.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/35.da69e6e8.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/36.fed52b27.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/37.c121f4e9.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/38.99baad0c.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/39.3dd6385d.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/4.4c65f11a.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/5.f5c5d1fb.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/6.9143e1f5.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/8.f2dc9578.js"><link rel="prefetch" href="/CPWR_DevOps_Examples/assets/js/9.e743477c.js">
    <link rel="stylesheet" href="/CPWR_DevOps_Examples/assets/css/0.styles.38688a71.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/CPWR_DevOps_Examples/" class="home-link router-link-active"><img src="/CPWR_DevOps_Examples/compuware.png" alt="Mainframe DevOps" class="logo"> <span class="site-name can-hide">Mainframe DevOps</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/CPWR_DevOps_Examples/" class="nav-link">Home</a></div><div class="nav-item"><a href="/CPWR_DevOps_Examples/pipelines/" class="nav-link router-link-active">Pipelines</a></div><div class="nav-item"><a href="/CPWR_DevOps_Examples/tool_configuration/" class="nav-link">Configuration</a></div><div class="nav-item"><a href="/CPWR_DevOps_Examples/code_examples/" class="nav-link">APIs</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/CPWR_DevOps_Examples/" class="nav-link">Home</a></div><div class="nav-item"><a href="/CPWR_DevOps_Examples/pipelines/" class="nav-link router-link-active">Pipelines</a></div><div class="nav-item"><a href="/CPWR_DevOps_Examples/tool_configuration/" class="nav-link">Configuration</a></div><div class="nav-item"><a href="/CPWR_DevOps_Examples/code_examples/" class="nav-link">APIs</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/CPWR_DevOps_Examples/pipelines/" class="sidebar-link">Getting Started</a></li><li><a href="/CPWR_DevOps_Examples/pipelines/pipelines.html" class="sidebar-link">Example Pipelines</a></li><li><a href="/CPWR_DevOps_Examples/pipelines/Mainframe_CI_Pipeline_from_Shared_Lib.html" class="active sidebar-link">Shared Library Example</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/CPWR_DevOps_Examples/pipelines/Mainframe_CI_Pipeline_from_Shared_Lib.html#setting-up-the-pipeline-job" class="sidebar-link">Setting up the pipeline job</a></li><li class="sidebar-sub-header"><a href="/CPWR_DevOps_Examples/pipelines/Mainframe_CI_Pipeline_from_Shared_Lib.html#mainframe-ci-pipeline-from-shared-lib" class="sidebar-link">MainframeCIPipelinefromShared_Lib</a></li></ul></li><li><a href="/CPWR_DevOps_Examples/pipelines/Mainframe-CI-Example-pipeline.html" class="sidebar-link">Basic Example</a></li><li><a href="/CPWR_DevOps_Examples/pipelines/scenario/" class="sidebar-link">ISPW Scenario</a></li><li><a href="/CPWR_DevOps_Examples/pipelines/scenario/TTT_scenario.html" class="sidebar-link">Total Test User Scenario</a></li><li><a href="/CPWR_DevOps_Examples/pipelines/pipeline_parameters.html" class="sidebar-link">Pipeline Parameters</a></li><li><a href="/CPWR_DevOps_Examples/pipelines/config_files.html" class="sidebar-link">Configuration Files</a></li><li><a href="/CPWR_DevOps_Examples/pipelines/helper_classes/" class="sidebar-link">Helper classes</a></li><li><a href="/CPWR_DevOps_Examples/pipelines/Jenkins_Groovy.html" class="sidebar-link">Groovy Tips</a></li></ul> </div> <div class="page"> <div class="content"><h2 id="setting-up-the-pipeline-job"><a href="#setting-up-the-pipeline-job" aria-hidden="true" class="header-anchor">#</a> Setting up the pipeline job</h2> <p>The job itself is defined via the usual way of creating a new pipeline job. It is important, though, to make sure that the resulting job uses parameters by checking the <code>This project is parameterized</code> box, <img src="/CPWR_DevOps_Examples/assets/img/parametertized_pipeline.261b5a73.png" alt="Parameterized Pipeline"></p> <p>Successively add the following string parameters (the default values are the ones used for the examples).</p> <p><img src="/CPWR_DevOps_Examples/assets/img/Adding_parameters.534c25bf.png" alt="Adding parameters"></p> <p>The parameters in this first set are specific to the individual execution of the pipeline and get passed by the <a href="/CPWR_DevOps_Examples/tool_configuration/webhook_setup.html">ISPW Webhook</a>.</p> <table><thead><tr><th>Name</th> <th>Default Value</th> <th>Description</th></tr></thead> <tbody><tr><td>ISPW_Stream</td> <td>FTSDEMO</td> <td>ISPW Stream Name</td></tr> <tr><td>ISPW_Application</td> <td>RXN3 ISPW Application</td> <td></td></tr> <tr><td>ISPW_Src_Level</td> <td>DEV1</td> <td>ISPW Level the promote has been started from</td></tr> <tr><td>ISPW_Release</td> <td></td> <td>ISPW Release Name</td></tr> <tr><td>ISPW_Container</td> <td></td> <td>ISPW Set ID</td></tr> <tr><td>ISPW_Container_Type</td> <td>2</td> <td>ISPW Container Type -0 - assignment -1 - release -2 - set</td></tr> <tr><td>ISPW_Owner</td> <td></td> <td>ISPW Owner User ID</td></tr></tbody></table> <h3 id="loading-the-script-from-a-shared-library"><a href="#loading-the-script-from-a-shared-library" aria-hidden="true" class="header-anchor">#</a> Loading the script from a shared library</h3> <p>To tell Jenkins to execute a pipeline from a shared library, you need to add code like the following to the Pipeline script definition.</p> <p><img src="/CPWR_DevOps_Examples/assets/img/pipeline_from_shared_lib.79e4f42c.png" alt="Pipeline from Shared Library"></p> <p>The example uses</p> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token annotation punctuation">@Library</span><span class="token punctuation">(</span><span class="token string">'RNU_Shared_Lib@Dev'</span><span class="token punctuation">)</span> <span class="token number">_</span>
<span class="token function">Mainframe_CI_Pipeline_from_Shared_Lib</span><span class="token punctuation">(</span>
    ISPW_Stream         <span class="token punctuation">:</span><span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Stream<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>                          <span class="token comment">// ISPW Stream</span>
    ISPW_Application    <span class="token punctuation">:</span><span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Application<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>                     <span class="token comment">// ISPW Application</span>
    ISPW_Release        <span class="token punctuation">:</span><span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Release<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>                         <span class="token comment">// ISPW Release</span>
    ISPW_Assignment     <span class="token punctuation">:</span><span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Assignment<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>                      <span class="token comment">// ISPW Assignment</span>
    ISPW_Container      <span class="token punctuation">:</span><span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Container<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>                       <span class="token comment">// ISPW Container (Set)</span>
    ISPW_Container_Type <span class="token punctuation">:</span><span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Container_Type<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>                  <span class="token comment">// ISPW Container Type (2 for Set)</span>
    ISPW_Src_Level      <span class="token punctuation">:</span><span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Src_Level<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>                       <span class="token comment">// ISPW Level the promote worked from</span>
    ISPW_Owner          <span class="token punctuation">:</span><span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Owner<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>                           <span class="token comment">// ISPW User doing the promote</span>
    Config_Git_Branch   <span class="token punctuation">:</span><span class="token string">'Dev'</span><span class="token punctuation">,</span>
    CES_Token           <span class="token punctuation">:</span><span class="token string">'xxxx'</span><span class="token punctuation">,</span>
    CES_Token_Clear     <span class="token punctuation">:</span><span class="token string">'xxxx'</span><span class="token punctuation">,</span>
    HCI_Conn_ID         <span class="token punctuation">:</span><span class="token string">'xxxx'</span><span class="token punctuation">,</span>
    HCI_Token           <span class="token punctuation">:</span><span class="token string">'xxxx'</span><span class="token punctuation">,</span>
    CC_repository       <span class="token punctuation">:</span><span class="token string">'xxxx'</span><span class="token punctuation">,</span>
    Git_Project         <span class="token punctuation">:</span><span class="token string">'xxxx'</span><span class="token punctuation">,</span>
    Git_Credentials     <span class="token punctuation">:</span><span class="token string">'xxxx'</span>
    <span class="token punctuation">)</span>
</code></pre></div><p>where</p> <ul><li><code>@Library('RNU_Shared_Lib@Dev') _</code>
refers to the name of a <a href="/CPWR_DevOps_Examples/pipelines/helper_classes/PipelineConfig.html">Shared Library</a>, with <code>@Dev</code> in this example referring to the <code>Dev</code> branch of the underlying GitHub repository. The trailing <code>_</code> is required by Jenkins.</li> <li><code>Mainframe_CI_Pipeline_from_Shared_Lib</code>
refers to the name of the <code>.groovy</code> file in the <code>vars</code> <a href="/CPWR_DevOps_Examples/" class="router-link-active">folder of the GitHub repository</a>, containing the pipeline code</li> <li>Within the brackets <code>(...)</code> parameters are passed to the pipeline script. <code>Mainframe_CI_Pipeline_from_Shared_Lib</code> expects a <code>groovy</code> <a href="http://groovy-lang.org/syntax.html#_maps" target="_blank" rel="noopener noreferrer"><code>Map</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, containing the following <code>key:value</code> pairs.</li></ul> <p>The parameters in this first set are specific to the individual execution of the pipeline. The values are the parameters defined in the [pipeline configuration above](#Setting up the pipeline job). The syntax <code>&quot;${parameter}&quot;</code> ensures that the value passed to this parameter is taken as value in the <code>Map</code>.</p> <table><thead><tr><th>Key</th> <th>Default Value</th> <th>Description</th></tr></thead> <tbody><tr><td>ISPW_Stream</td> <td>&quot;${ISPW_Stream}&quot;</td> <td>The ISPW_Stream parameter from the pipeline configuration above</td></tr> <tr><td>ISPW_Application</td> <td>&quot;${ISPW_Application}&quot;</td> <td>The ISPW_Application parameter from the pipeline configuration above</td></tr> <tr><td>ISPW_Release</td> <td>&quot;${ISPW_Release}&quot;</td> <td>The ISPW_Release parameter from the pipeline configuration above</td></tr> <tr><td>ISPW_Assignment</td> <td>&quot;${ISPW_Assignment}&quot;</td> <td>The ISPW_Assignment parameter from the pipeline configuration above</td></tr> <tr><td>ISPW_Container</td> <td>&quot;${ISPW_Container}&quot;</td> <td>The ISPW_Container parameter from the pipeline configuration above</td></tr> <tr><td>ISPW_Container_Type</td> <td>&quot;${ISPW_Container_Type}&quot;</td> <td>The ISPW_Container_Type parameter from the pipeline configuration above</td></tr> <tr><td>ISPW_Src_Level</td> <td>&quot;${ISPW_Src_Level}&quot;</td> <td>The ISPW_Src_Level parameter from the pipeline configuration above</td></tr> <tr><td>ISPW_Owner</td> <td>&quot;${ISPW_Owner}&quot;</td> <td>The ISPW_Owner parameter from the pipeline configuration above</td></tr></tbody></table> <p>The second set of parameters is installation specific and reference tokens and other IDs that have been defined during the configuration phase. To determine the appropriate values to use refer to the <a href="/CPWR_DevOps_Examples/pipelines/pipeline_parameters.html">description of the pipeline parameters</a>.</p> <p>Usually, these parameters will be installation specific rather than pipeline job or execution specific. Future versions of the example will take care of this, and move these parameters to configuration files.</p> <table><thead><tr><th>Key</th> <th>Default Value</th> <th>Description</th></tr></thead> <tbody><tr><td>Config_Git_Branch</td> <td>Branch in the Git repository where configuration files are to be read from</td> <td></td></tr> <tr><td>CES_Token</td> <td>The Jenkins token, referring to the CES token</td> <td></td></tr> <tr><td>CES_Token_Clear</td> <td>The &quot;clear text&quot; CES token (as copied from the CES server's Security &gt; <a href="/CPWR_DevOps_Examples/tool_configuration/CES_credentials_token.html">Personal Access Tokens page</a>.</td> <td></td></tr> <tr><td>HCI_Conn_ID</td> <td>The Jenkins internal ID for the HCI connection to use</td> <td></td></tr> <tr><td>HCI_Token</td> <td>Jenkins internal ID for HCI Token</td> <td></td></tr> <tr><td>CC_repository</td> <td>The Xpediter Code Coverage repository to use</td> <td></td></tr> <tr><td>Git_Project</td> <td>The name of the GitHub repository storing Topaz for Total Test assets</td> <td></td></tr> <tr><td>Git_Credentials</td> <td>Jenkins internal ID for credentials to use the GitHub repository</td> <td></td></tr></tbody></table> <h2 id="mainframe-ci-pipeline-from-shared-lib"><a href="#mainframe-ci-pipeline-from-shared-lib" aria-hidden="true" class="header-anchor">#</a> Mainframe_CI_Pipeline_from_Shared_Lib</h2> <p>Being a pipeline from a <a href="https://jenkins.io/doc/book/pipeline/shared-libraries/" target="_blank" rel="noopener noreferrer">shared library<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> this pipeline must extend a <code>call</code> method. This pipeline expects a <a href="http://groovy-lang.org/syntax.html#_maps" target="_blank" rel="noopener noreferrer"><code>Map</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> object, containing the parameters to be passed to the pipeline from the job configuration and trigger.</p> <p>Once this pipeline has been triggered, the job will execute the following steps.</p> <ol><li>Execute its <code>call</code> method, within which it will</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token keyword">def</span> <span class="token function">call</span><span class="token punctuation">(</span>Map pipelineParams<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    node
    <span class="token punctuation">{</span>
</code></pre></div><ol start="2"><li>Execute its <code>initialize</code> method to read configuration files and instantiate objects of <a href="/CPWR_DevOps_Examples/pipelines/helper_classes/PipelineConfig.html">helper classes</a> <ul><li><code>PipelineConfig</code> containing global parameter values that:
<ul><li>passed by the job configuration/trigger and are pipeline/execution specific</li> <li>not pipeline or execution specific, like server URLs. These parameters will be read from external configuration files</li></ul></li> <li><code>GitHelper</code> serving as a wrapper for a set of interactions with Git/GitHub</li> <li><code>IspwHelper</code> serving as a wrapper for use of the ISPW plugins' methods</li> <li><code>TttHelper</code> serving as a wrapper for use of the TTT plugin's and Code Coverage plugin's methods</li> <li><code>SonarHelper</code> serving as a wrapper for use of the Sonar plugins' methods</li></ul></li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code>        <span class="token function">initialize</span><span class="token punctuation">(</span>pipelineParams<span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>Use the <code>downloadSources</code> method of class <code>IspwHelper</code> to download all COBOL sources and COBOL copybooks from ISPW (the mainframe) that are part of the set triggering this specific pipeline execution</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code>        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Retrieve Code From ISPW&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            ispwHelper<span class="token operator">.</span><span class="token function">downloadSources</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>Not always will all required COBOL copybooks be part of an ISPW assignment or set. In order to retrieve any missing copybooks, the next stage will use the <code>downloadCopyBooks</code> method of class <code>ispwHelper</code> to determine all required copybooks and download them from the mainframe</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code>        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Retrieve Copy Books From ISPW&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            ispwHelper<span class="token operator">.</span><span class="token function">downloadCopyBooks</span><span class="token punctuation">(</span><span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>workspace<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
</code></pre></div><ol start="5"><li>Use the <code>checkout</code> method of the <code>gitHelper</code>class to clone the Git repository for the ISPW application.</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code>        <span class="token comment">/* Retrieve the Tests from Github that match that ISPWW Stream and Application */</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Retrieve Tests&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">def</span> gitUrlFullPath <span class="token operator">=</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>pConfig<span class="token operator">.</span>gitUrl<span class="token punctuation">}</span></span>/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>pConfig<span class="token operator">.</span>gitTttRepo<span class="token punctuation">}</span></span>&quot;</span>

            gitHelper<span class="token operator">.</span><span class="token function">checkout</span><span class="token punctuation">(</span>gitUrlFullPath<span class="token punctuation">,</span> pConfig<span class="token operator">.</span>gitBranch<span class="token punctuation">,</span> pConfig<span class="token operator">.</span>gitCredentials<span class="token punctuation">,</span> pConfig<span class="token operator">.</span>tttFolder<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre></div><ol start="6"><li>Initialize the <code>TttHelper</code> instance, loop through the downloaded Topaz for Total Test scenarios, and pass the results to JUnit (within Jenkins) using the methods <code>initialize</code>, <code>loopThruScenarios</code>, and <code>passResultsToJunit</code> of the <code>TttHelper</code> class, respectively.</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code>        <span class="token comment">/*
        This stage executes any Total Test Projects related to the mainframe source that was downloaded
        */</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Execute related Unit Tests&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            tttHelper<span class="token operator">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            tttHelper<span class="token operator">.</span><span class="token function">loopThruScenarios</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            tttHelper<span class="token operator">.</span><span class="token function">passResultsToJunit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
</code></pre></div><ol start="7"><li>Use the <code>collectCodeCoverageResults</code> method of the <code>TttHelper</code> class to download the code coveragre metrics from the Xpediter Code Coverage repository</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code>        <span class="token comment">/*
        This stage retrieve Code Coverage metrics from Xpediter Code Coverage for the test executed in the Pipeline
        */</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Collect Coverage Metrics&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            tttHelper<span class="token operator">.</span><span class="token function">collectCodeCoverageResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
</code></pre></div><ol start="8"><li>Use the <code>scan</code> method of the <code>SonarHelper</code> class to pass downloaded COBOL sources, the results of the unit tests, and code coverage metrics to SonarQube</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code>        <span class="token comment">/*
        This stage pushes the Source Code, Test Metrics and Coverage metrics into SonarQube and then checks the status of the SonarQube Quality Gate.  
        If the SonarQube quality date fails, the Pipeline fails and stops
        */</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Check SonarQube Quality Gate&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            sonarHelper<span class="token operator">.</span><span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">...</span>
</code></pre></div><ol start="9"><li>Query the resulting Sonar quality gate, by registering a Sonar Webhook call back, if the quality gate fails, an email will be sent to the owner of the ISPW set - notifying them about the failure of the promote -, and the pipeline job will be aborted</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token punctuation">...</span>
            <span class="token comment">// Wait for the results of the SonarQube Quality Gate</span>
            <span class="token function">timeout</span><span class="token punctuation">(</span>time<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> unit<span class="token punctuation">:</span> <span class="token string">'MINUTES'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token comment">// Wait for webhook call back from SonarQube.  SonarQube webhook for callback to Jenkins must be configured on the SonarQube server.</span>
                <span class="token keyword">def</span> sonarGate <span class="token operator">=</span> <span class="token function">waitForQualityGate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                <span class="token comment">// Evaluate the status of the Quality Gate</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>sonarGate<span class="token operator">.</span>status <span class="token operator">!=</span> <span class="token string">'OK'</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    echo <span class="token string gstring">&quot;Sonar quality gate failure: <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>sonarGate<span class="token operator">.</span>status<span class="token punctuation">}</span></span>&quot;</span>
                    echo <span class="token string gstring">&quot;Pipeline will be aborted and ISPW Assignment will be regressed&quot;</span>

                    currentBuild<span class="token operator">.</span>result <span class="token operator">=</span> <span class="token string gstring">&quot;FAILURE&quot;</span>

                    <span class="token comment">// Send Standard Email</span>
                    emailext subject<span class="token punctuation">:</span>       <span class="token string">'$DEFAULT_SUBJECT'</span><span class="token punctuation">,</span>
                                body<span class="token punctuation">:</span>       <span class="token string">'$DEFAULT_CONTENT'</span><span class="token punctuation">,</span>
                                replyTo<span class="token punctuation">:</span>    <span class="token string">'$DEFAULT_REPLYTO'</span><span class="token punctuation">,</span>
                                to<span class="token punctuation">:</span>         <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>pConfig<span class="token operator">.</span>mailRecipient<span class="token punctuation">}</span></span>&quot;</span>

                    <span class="token function">withCredentials</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">string</span><span class="token punctuation">(</span>credentialsId<span class="token punctuation">:</span> pConfig<span class="token operator">.</span>cesTokenId<span class="token punctuation">,</span> variable<span class="token punctuation">:</span> <span class="token string">'cesTokenClear'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token comment">//ispwHelper.regressAssignmentList(assignmentList, cesTokenClear)</span>
                        ispwHelper<span class="token operator">.</span><span class="token function">regressAssignment</span><span class="token punctuation">(</span>pConfig<span class="token operator">.</span>ispwAssignment<span class="token punctuation">,</span> cesTokenClear<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>

                    error <span class="token string gstring">&quot;Exiting Pipeline&quot;</span> <span class="token comment">// Exit the pipeline with an error if the SonarQube Quality Gate is failing</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre></div><ol start="10"><li>If the quality gate passes an XL Release template will be triggered - using the XL Release plugin - to execute CD stages beyond the Jenkins pipeline, and an email will be sent to the owner of the ISPW set - notifying them about the success of the promote</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code>        <span class="token comment">/*
        This stage triggers a XL Release Pipeline that will move code into the high levels in the ISPW Lifecycle  
        */</span>
        <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Start release in XL Release&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Trigger XL Release Jenkins Plugin to kickoff a Release</span>
            <span class="token function">xlrCreateRelease</span><span class="token punctuation">(</span>
                releaseTitle<span class="token punctuation">:</span>       <span class="token string">'A Release for $BUILD_TAG'</span><span class="token punctuation">,</span>
                serverCredentials<span class="token punctuation">:</span>  <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>pConfig<span class="token operator">.</span>xlrUser<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>
                startRelease<span class="token punctuation">:</span>       <span class="token boolean">true</span><span class="token punctuation">,</span>
                template<span class="token punctuation">:</span>           <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>pConfig<span class="token operator">.</span>xlrTemplate<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>
                variables<span class="token punctuation">:</span>          <span class="token punctuation">[</span>
                                        <span class="token punctuation">[</span>propertyName<span class="token punctuation">:</span>  <span class="token string">'ISPW_Dev_level'</span><span class="token punctuation">,</span>   propertyValue<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>pConfig<span class="token operator">.</span>ispwTargetLevel<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// Level in ISPW that the Code resides currently</span>
                                        <span class="token punctuation">[</span>propertyName<span class="token punctuation">:</span>  <span class="token string">'ISPW_RELEASE_ID'</span><span class="token punctuation">,</span>  propertyValue<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>pConfig<span class="token operator">.</span>ispwRelease<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token comment">// ISPW Release value from the ISPW Webhook</span>
                                        <span class="token punctuation">[</span>propertyName<span class="token punctuation">:</span>  <span class="token string">'CES_Token'</span><span class="token punctuation">,</span>        propertyValue<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>pConfig<span class="token operator">.</span>cesTokenId<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">]</span>
                                    <span class="token punctuation">]</span>
            <span class="token punctuation">)</span>

            <span class="token comment">// Send Standard Email</span>
            emailext subject<span class="token punctuation">:</span>       <span class="token string">'$DEFAULT_SUBJECT'</span><span class="token punctuation">,</span>
                        body<span class="token punctuation">:</span>       <span class="token string">'$DEFAULT_CONTENT \n'</span> <span class="token operator">+</span> <span class="token string">'Promote passed the Quality gate and a new XL Release was started.'</span><span class="token punctuation">,</span>
                        replyTo<span class="token punctuation">:</span>    <span class="token string">'$DEFAULT_REPLYTO'</span><span class="token punctuation">,</span>
                        to<span class="token punctuation">:</span>         <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>pConfig<span class="token operator">.</span>mailRecipient<span class="token punctuation">}</span></span>&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/CPWR_DevOps_Examples/pipelines/pipelines.html" class="prev">
          Example Pipelines
        </a></span> <span class="next"><a href="/CPWR_DevOps_Examples/pipelines/Mainframe-CI-Example-pipeline.html">
          Basic Example
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/CPWR_DevOps_Examples/assets/js/app.75a8ec7a.js" defer></script><script src="/CPWR_DevOps_Examples/assets/js/7.3a9c137b.js" defer></script>
  </body>
</html>
